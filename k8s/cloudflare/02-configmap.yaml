apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: default
data:
  config.yaml: |
    tunnel: 38b88573-0d04-400d-ad1f-52f22379a2a7
    credentials-file: /etc/cloudflared/credentials.json
    metrics: 0.0.0.0:2000
    no-autoupdate: true
    protocol: quic

    # Global origin request settings for security
    originRequest:
      connectTimeout: 30s
      tlsTimeout: 30s
      tcpKeepAlive: 30s
      noHappyEyeballs: false
      keepAliveConnections: 100
      keepAliveTimeout: 90s
      httpHostHeader: ""
      originServerName: ""

    ingress:
      # Portfolio Website (Served by Main App)
      - hostname: gurukripacoldstore.in
        service: http://cold-backend-employee:8080
        originRequest:
          noTLSVerify: false
          httpHostHeader: gurukripacoldstore.in
          connectTimeout: 30s

      # Production - Customer Portal (HTTPS enforced)
      - hostname: customer.gurukripacoldstore.in
        service: http://cold-backend-customer:8081
        originRequest:
          noTLSVerify: false
          httpHostHeader: customer.gurukripacoldstore.in
          connectTimeout: 30s

      # Production - Employee Portal (with www)
      - hostname: www.app.gurukripacoldstore.in
        service: http://cold-backend-employee:8080
        originRequest:
          noTLSVerify: false
          httpHostHeader: www.app.gurukripacoldstore.in
          connectTimeout: 30s

      # Production - Employee Portal (without www)
      - hostname: app.gurukripacoldstore.in
        service: http://cold-backend-employee:8080
        originRequest:
          noTLSVerify: false
          httpHostHeader: app.gurukripacoldstore.in
          connectTimeout: 30s

      # Catch-all (required)
      - service: http_status:404
