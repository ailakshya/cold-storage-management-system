version: '3.8'

services:
  # Base application setup - common configuration
  # Base application setup - common configuration
  app-base: &app-base
    build: .
    restart: unless-stopped
    network_mode: "host"
    volumes:
      - /mass-pool:/mass-pool
      - ./backups:/app/backups
      - ./logs:/app/logs
    environment:
      - BACKUP_DIR=/mass-pool/backups
      - DB_HOST=${DB_HOST:-127.0.0.1}
      - DB_USER=${DB_USER:-postgres}
      - DB_PASSWORD=${DB_PASSWORD:-postgres}
      - DB_NAME=${DB_NAME:-cold_db}
      - REDIS_HOST=${REDIS_HOST:-127.0.0.1}

  # Employee Management Portal (Default: 8080)
  employee-portal:
    <<: *app-base
    container_name: cold-employee
    command: ["-mode", "employee", "-port", "8080"]

  # Customer Portal (Default: 8081)
  customer-portal:
    <<: *app-base
    container_name: cold-customer
    command: ["-mode", "customer", "-port", "8081"]

  # Website Public Facing (Default: 8082)
  website:
    <<: *app-base
    container_name: cold-website
    command: ["-mode", "website", "-port", "8082"]

  # Optional: Run Redis if not on host
  # redis:
  #   image: redis:alpine
  #   container_name: cold-redis
  #   restart: always
  #   ports:
  #     - "6379:6379"
